---
## Front matter
lang: ru-RU
title: "Лабораторная работа №9" 
subtitle: "Настройка SMTP-сервера"
author:
  - Андреева С.В.
institute:
  - Группа НПИбд-01-23
  - Российский университет дружбы народов, Москва, Россия

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
toc-title: Содержание
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
 - '\makeatletter'
 - '\beamer@ignorenonframefalse'
 - '\makeatother'

## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
---

# Информация

## Докладчик

:::::::::::::: {.columns align=center}
::: {.column width="70%"}

  * Андреева Софья Владимировна
  * Группа НПИбд-01-23
  * Российский университет дружбы народов


:::
::: {.column width="30%"}


:::
::::::::::::::

# Вводная часть

## Цель работы

Приобретение практических навыков по установке и простейшему конфигурированию POP3/IMAP-сервера.

## Установка Dovecot

Загрузим нашу операционную систему и перейдем в рабочий каталог с проектом:
```
cd /var/tmp/svandreeva/vagrant
```
Затем запустим виртуальную машину server:
```
make server-up
```

## Выполнение работы

Откроем терминал и, перейдя в режим суперпользователя, установим необходимые для работы пакеты

![Установка Dovecot](image/1.png){#fig:001 width=60%}

## Выполнение работы

В конфигурационном файле /etc/dovecot/dovecot.conf пропишем список почтовых протоколов, по которым разрешено работать Dovecot

![Редактирование файла /etc/dovecot/dovecot.conf](image/2.png){#fig:002 width=60%}

## Выполнение работы

В конфигурационном файле /etc/dovecot/conf.d/10-auth.conf укажем метод аутентификации plain

![Редактирование файла /etc/dovecot/conf.d/10-auth.conf](image/3.png){#fig:003 width=60%}

## Выполнение работы

В конфигурационном файле /etc/dovecot/conf.d/auth-system.conf.ext проверим, что для поиска пользователей и их паролей используется pam и файл passwd

## Выполнение работы

![Просмотр файла /etc/dovecot/conf.d/auth-system.conf.ext](image/4.png){#fig:004 width=70%}

## Выполнение работы

![Просмотр файла /etc/dovecot/conf.d/auth-system.conf.ext](image/5.png){#fig:005 width=70%}

## Выполнение работы

В конфигурационном файле /etc/dovecot/conf.d/10-mail.conf настроим месторасположение почтовых ящиков пользователей

![Редактирование файла /etc/dovecot/conf.d/10-mail.conf](image/6.png){#fig:006 width=60%}

## Выполнение работы

В Postfix зададим каталог для доставки почты, затем сконфигурируем межсетевой экран, разрешив работать службам  протоколов POP3 и IMAP, восстановим контекст безопасности SELinux, а затем перезапустим Postfix и запустим Dovecot

## Выполнение работы

![Конфигурация Postfix, межсетевого экрана для работы с POP3 и IMAP и запуск Dovecot](image/7.png){#fig:007 width=70%}


## Проверка работы Dovecot

На дополнительном терминале виртуальной машины server запустим мониторинг
работы почтовой службы с помощью команды:

```
tail -f /var/log/maillog
```

## Выполнение работы

На терминале сервера просмотрим имеющуюся почту и mailbox пользователя на сервере

![Просмотр почты и mailbox](image/8.png){#fig:008 width=60%}

## Выполнение работы

На виртуальной машине client войдем под своим пользователем и откроем терминал. Перейдем в режим суперпользователя и установим почтовый клиент

![Установка почтового клиента evolution на виртуальную машину client](image/9.png){#fig:009 width=60%}

## Выполнение работы

Запустим и настроим почтовый клиент Evolution. В окне настройки учётной записи почты укажим имя, адрес почты svandreeva@svandreeva.net, введите пароль нашего пользователя

![Настройка учетной записи почтового клиента](image/10.png){#fig:010 width=60%}

## Выполнение работы

В качестве IMAP-сервера для входящих сообщений и SMTP-сервера для исходящих
сообщений пропишем mail.svandreeva.net, в качестве пользователя для входящих
и исходящих сообщений укажем svandreeva, также укажем номера портов: для IMAP -- порт 143, для SMTP -- порт 25, и укажем настройки SSL и метода аутентификации: для IMAP -- STARTTLS, аутентификация по обычному паролю, для SMTP -- без аутентификации, аутентификация -- «Без аутентификации»

## Выполнение работы

![Настройка IMAP-сервера для входящих сообщений](image/11.png){#fig:011 width=70%}

## Выполнение работы

![Настройка SMTP-сервера для исходящих сообщений](image/12.png){#fig:012 width=70%}

## Выполнение работы

Из почтового клиента отправим себе два тестовых письма, убедимся, что они доставлены

![Проверка получения писем на почтовом клиенте](image/13.png){#fig:013 width=60%}

## Выполнение работы

Посмотрим, какие сообщения выдаются при мониторинге почтовой службы на сервере, а также при использовании doveadm и mail

## Выполнение работы

![Просмотр мониторинга почтовой службы на сервере](image/14.png){#fig:014 width=70%}

## Выполнение работы

![Просмотр информации о почтовой службе с помощью doveadm и mail](image/15.png){#fig:015 width=70%}

Проверим работу почтовой службы, используя на сервере протокол Telnet. Для этого подключимся с помощью протокола Telnet к почтовому серверу по протоколу POP3
(через порт 110), введем свой логин для подключения и пароль. А затем с помощью команды list получим список писем; с помощью команды retr 1 получим первое письмо из списка; с помощью команды dele 2 удалим второе письмо из списка; с помощью команды quit завершите сеанс работы с telnet

## Выполнение работы

![Проверка почтовой службы с помощью протокола Telnet](image/16.png){#fig:016 width=40%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перейдем в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/. В соответствующие подкаталоги поместим конфигурационные файлы Doveco, а также заменим конфигурационный файл Postfix

## Выполнение работы

![Создание окружения для внесения изменений в настройки окружающей среды](image/17.png){#fig:017 width=70%}

## Выполнение работы

Внесием изменения в файл /vagrant/provision/server/mail.sh, добавив в него
строки по установке Dovecot и Telnet; по настройке межсетевого экрана; по настройке Postfix в части задания месторасположения почтового ящика; по перезапуску Postfix и запуску Dovecot

## Выполнение работы

![Изменение файла /vagrant/provision/server/mail.sh](image/18.png){#fig:018 width=70%}

## Выполнение работы

На виртуальной машине client в каталоге /vagrant/provision/client скорректируем файл mail.sh, прописав в нём команду для установки почтового клиента evolution:

![Изменение файла /vagrant/provision/client/mail.sh](image/19.png){#fig:019 width=60%}

# Выводы

В результате выполнения данной работы были приобретены практические навыки по установке и простейшему конфигурированию POP3/IMAP-сервера.